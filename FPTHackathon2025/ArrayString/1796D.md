## ğŸ§  Má»¥c tiÃªu bÃ i toÃ¡n (tÃ³m táº¯t)

ChÃºng ta Ä‘Æ°á»£c cho má»™t máº£ng `a` vÃ  hai sá»‘ nguyÃªn `k`, `x`.  
Pháº£i chá»n Ä‘Ãºng `k` vá»‹ trÃ­ Ä‘á»ƒ **cá»™ng thÃªm `x`**, cÃ¡c vá»‹ trÃ­ cÃ²n láº¡i **trá»« Ä‘i `x`**.  
Sau Ä‘Ã³, tÃ¬m **tá»•ng lá»›n nháº¥t cá»§a má»™t dÃ£y con liÃªn tiáº¿p** trong máº£ng Ä‘Ã£ biáº¿n Ä‘á»•i.

---

## ğŸ” Ã tÆ°á»Ÿng chÃ­nh: DÃ¹ng Quy hoáº¡ch Ä‘á»™ng (DP) 3D

Ta dÃ¹ng báº£ng DP 3 chiá»u:

```cpp
dp[i][j][s]
```

Vá»›i:
- `i`: Ä‘Ã£ xá»­ lÃ½ xong `i` pháº§n tá»­ Ä‘áº§u tiÃªn
- `j`: Ä‘Ã£ dÃ¹ng `j` phÃ©p toÃ¡n cá»™ng `x`
- `s`: tráº¡ng thÃ¡i hiá»‡n táº¡i cá»§a dÃ£y con:
  - `s = 0`: chÆ°a báº¯t Ä‘áº§u dÃ£y con
  - `s = 1`: Ä‘ang á»Ÿ trong dÃ£y con
  - `s = 2`: Ä‘Ã£ káº¿t thÃºc dÃ£y con

Má»¥c tiÃªu: TÃ¬m `max(dp[n][k][1], dp[n][k][2])` â†’ tá»©c lÃ  giÃ¡ trá»‹ lá»›n nháº¥t cá»§a dÃ£y con khi Ä‘Ã£ xá»­ lÃ½ háº¿t máº£ng vÃ  dÃ¹ng Ä‘Ãºng `k` láº§n cá»™ng `x`.

---

## ğŸ” VÃ²ng láº·p chÃ­nh vÃ  giáº£i thÃ­ch chi tiáº¿t

### âœ… Khá»Ÿi táº¡o DP

```cpp
vector<vector<vector<ll>>> dp(n + 1, vector<vector<ll>>(k + 1, vector<ll>(3, -INF)));
dp[0][0][0] = 0;
```

> ÄÃ¢y lÃ  bÆ°á»›c chuáº©n bá»‹ ban Ä‘áº§u. Ta khá»Ÿi táº¡o toÃ n bá»™ báº£ng `dp` vá»›i giÃ¡ trá»‹ `-INF` (ráº¥t nhá»), ngoáº¡i trá»« `dp[0][0][0] = 0` â€” tá»©c lÃ  khÃ´ng lÃ m gÃ¬ cáº£ thÃ¬ tá»•ng lÃ  0.

---

### âœ… VÃ²ng láº·p chÃ­nh

```cpp
for (int i = 0; i < n; ++i) {
    for (int j = 0; j <= k; ++j) {
        for (int state = 0; state < 3; ++state) {
            if (dp[i][j][state] == -INF) continue;

            // Code xá»­ lÃ½ tá»«ng trÆ°á»ng há»£p sáº½ á»Ÿ Ä‘Ã¢y
        }
    }
}
```

> VÃ²ng láº·p nÃ y duyá»‡t qua tá»«ng pháº§n tá»­ trong máº£ng (`i`) vÃ  tá»«ng tráº¡ng thÃ¡i cÃ³ thá»ƒ (`j`, `state`). Náº¿u tráº¡ng thÃ¡i `(i,j,state)` khÃ´ng kháº£ thi (giÃ¡ trá»‹ lÃ  `-INF`), bá» qua.

---

## ğŸŸ¢ TrÆ°á»ng há»£p 1: Trá»« `x` khá»i pháº§n tá»­ hiá»‡n táº¡i

```cpp
ll val_sub = a[i] - x;
for (int next_state = state; next_state < 3; ++next_state) {
    dp[i + 1][j][next_state] = max(
        dp[i + 1][j][next_state],
        dp[i][j][state] + (next_state == 1 ? val_sub : 0)
    );
}
```

> â“ **Giáº£i thÃ­ch:**
- Ta **khÃ´ng dÃ¹ng phÃ©p toÃ¡n cá»™ng `x`**, nÃªn `j` giá»¯ nguyÃªn.
- GiÃ¡ trá»‹ má»›i cá»§a pháº§n tá»­ lÃ  `a[i] - x`.
- Chá»‰ tÃ­nh giÃ¡ trá»‹ nÃ y vÃ o tá»•ng náº¿u ta Ä‘ang á»Ÿ trong dÃ£y con (`next_state == 1`).
- CÃ³ thá»ƒ chuyá»ƒn tá»« tráº¡ng thÃ¡i `state` sang báº¥t ká»³ tráº¡ng thÃ¡i nÃ o `>= state` (vÃ­ dá»¥: tá»« chÆ°a báº¯t Ä‘áº§u â†’ váº«n chÆ°a báº¯t Ä‘áº§u hoáº·c báº¯t Ä‘áº§u).

---

## ğŸ”µ TrÆ°á»ng há»£p 2: Cá»™ng `x` vÃ o pháº§n tá»­ hiá»‡n táº¡i (náº¿u cÃ²n phÃ©p)

```cpp
if (j < k) {
    ll val_add = a[i] + x;
    for (int next_state = state; next_state < 3; ++next_state) {
        dp[i + 1][j + 1][next_state] = max(
            dp[i + 1][j + 1][next_state],
            dp[i][j][state] + (next_state == 1 ? val_add : 0)
        );
    }
}
```

> â“ **Giáº£i thÃ­ch:**
- Chá»‰ thá»±c hiá»‡n náº¿u cÃ²n phÃ©p cá»™ng `x` (`j < k`)
- GiÃ¡ trá»‹ má»›i cá»§a pháº§n tá»­ lÃ  `a[i] + x`
- TÄƒng sá»‘ láº§n sá»­ dá»¥ng lÃªn: `j + 1`
- CÅ©ng chá»‰ tÃ­nh vÃ o tá»•ng náº¿u Ä‘ang á»Ÿ trong dÃ£y con (`next_state == 1`)
- Giá»¯ nguyÃªn logic chuyá»ƒn tráº¡ng thÃ¡i nhÆ° trÆ°á»›c.

---

## ğŸ“Œ Káº¿t quáº£ cuá»‘i cÃ¹ng

```cpp
cout << max(dp[n][k][1], dp[n][k][2]) << '\n';
```

> Sau khi xá»­ lÃ½ háº¿t máº£ng (`i = n`), vÃ  Ä‘Ã£ dÃ¹ng Ä‘Ãºng `k` láº§n cá»™ng `x`, chÃºng ta láº¥y giÃ¡ trá»‹ lá»›n nháº¥t giá»¯a:
- `dp[n][k][1]`: Ä‘ang á»Ÿ trong dÃ£y con
- `dp[n][k][2]`: Ä‘Ã£ káº¿t thÃºc dÃ£y con

---

## âœ… VÃ­ dá»¥ minh há»a

**Input:**

```
1
4 1 2
2 -1 2 3
```

**Output:**

```
5
```

> NghÄ©a lÃ : chá»‰ Ä‘Æ°á»£c cá»™ng `2` vÃ o 1 vá»‹ trÃ­, vÃ­ dá»¥ chá»n vá»‹ trÃ­ `0` â†’ máº£ng thÃ nh `[4, -3, 0, 1]`. DÃ£y con lá»›n nháº¥t lÃ  `[4]` â†’ tá»•ng lÃ  `5`.

---

## ğŸ“Œ Tá»•ng káº¿t

| Pháº§n | Giáº£i thÃ­ch |
|------|------------|
| `dp[i][j][s]` | Cáº­p nháº­t tráº¡ng thÃ¡i theo tá»«ng bÆ°á»›c vÃ  theo tá»«ng tráº¡ng thÃ¡i cá»§a dÃ£y con |
| `val_sub` | Xá»­ lÃ½ trÆ°á»ng há»£p trá»« `x` |
| `val_add` | Xá»­ lÃ½ trÆ°á»ng há»£p cá»™ng `x` náº¿u cÃ²n phÃ©p |
| `next_state` | Quáº£n lÃ½ viá»‡c báº¯t Ä‘áº§u / Ä‘ang trong / káº¿t thÃºc dÃ£y con |
| `max(...)` | LuÃ´n chá»n giÃ¡ trá»‹ tá»‘t nháº¥t |

---

Image explaination:
![DP explained](image.png)